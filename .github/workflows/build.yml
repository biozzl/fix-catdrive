name: Run Custom Identity Script

on: 
  workflow_dispatch: # 允许手动点击按钮触发

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Check Files
        run: |
          ls -l
          # --- 修正点：检查 V8 脚本需要的原料 ---
          if [ ! -f "hybrid_ultimate.bin" ]; then echo "Error: hybrid_ultimate.bin not found! Please upload it."; exit 1; fi
          # 检查脚本是否存在
          if [ ! -f "custom_identity.py" ]; then echo "Error: custom_identity.py not found!"; exit 1; fi

      - name: Run Hybrid Script
        # 运行 V8 脚本
        run: python custom_identity.py

      - name: Upload Hybrid Firmware
        uses: actions/upload-artifact@v4
        with:
          name: Hybrid-V8-Final
          # --- 关键点：这里必须和 V8 脚本里的 output_file 一致 ---
          path: hybrid_v8_final.bin 
          compression-level: 0
